var app=angular.module("geolocation",["ngMap"]);app.factory("getLocation",function(){return"http://ip-api.com/json/"}),app.controller("Location",function($scope,$http,NgMap,getLocation){"use strict";$scope.locations=[{query:"0.0.0.0"}],$scope.now,$scope.errorMsg="",$scope.getMyLocation=function(){$http.get(getLocation).then(function(response){if("success"==response.data.status)if(response.data.from="Yours",response.data.icon="user.png","0.0.0.0"===$scope.locations[0].query)$scope.locations[0]=response.data;else if(0!==$scope.locations.length)for(var i=0;i<$scope.locations.length;i++)"Yours"==$scope.locations[i].from&&($scope.locations[i]=response.data);else $scope.setNewResult(response.data);else $scope.errorMsg="Your location isn't available, please try again";$scope.now=new Date})},$scope.getWebsiteLocation=function(site){console.log($scope.f.url);var regex=/^(www\.)?(([a-zA-Z]{1})|([a-zA-Z]{1}[a-zA-Z]{1})|([a-zA-Z]{1}[0-9]{1})|([0-9]{1}[a-zA-Z]{1})|([a-zA-Z0-9][a-zA-Z0-9]{1,61}[a-zA-Z0-9]))\.([a-zA-Z]{2,6}|[a-zA-Z0-9]{2,30}\.[a-zA-Z]{2,3})$/;$scope.f.$valid&&regex.test(site)&&$http.get(getLocation+site).then(function(response){if("success"==response.data.status)if(response.data.from="Web site",response.data.icon="server.png",console.log($scope.locations),$scope.locations.length>1)for(var i=0;i<$scope.locations.length;i++)"Web site"==$scope.locations[i].from&&($scope.locations[i]=response.data);else $scope.setNewResult(response.data);else $scope.errorMsg="Domain "+response.data.query+" is invalid, please try again",$scope.locations.splice(1,1);$scope.now=new Date})},$scope.resetLocation=function(){$scope.locations[0]={query:"0.0.0.0",country:"",regionName:"",city:"",timezone:"",lat:"",lon:"",from:""}},$scope.clickHelp=function(fieldName,location){console.log(location),$scope.msg="This is your "+fieldName+" from ISP "+location.isp+" at "+$scope.now},$scope.setNewResult=function(data){var currentLocation=$scope.locations,newLocation=currentLocation.concat(data);$scope.locations=newLocation}});